<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="x-ua-compatible" content="IE=9" >

<title>Abstract/Summary</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>




</head>

<body>
<h2>Abstract/Summary</h2>

<p>This blog post is about options for making dynamic documents in Stata using Markdown, discussing the options of <a href="http://homepage.cs.uiowa.edu/%7Erlenth/StatWeave/">StatWeave</a> and a do file created from a user, <a href="https://github.com/amarder/stata-tutorial"><code>knitr.do</code></a>.  I will discuss some the capacities of these options and show options for custom use if you know how to use RMarkdown.  </p>

<h2>Knitr: Dynamic Documents</h2>

<p>If you use <code>R</code>, or even if you don&#39;t, you mave heard of the phrases &ldquo;dynamic documents&rdquo;, &ldquo;reproducible reports&rdquo;, &ldquo;markdown&rdquo;, &ldquo;Rmarkdown&rdquo;, or more specifically &ldquo;knitting/knitr&rdquo;.  For pronunciation: according to the <code>knitr</code> documentation in <code>R</code>:</p>

<blockquote>
<p>The pronunciation of knitr is similar to neater (neater than what?) or you can think of knitter (but it is single t). The name comes from knit + R (while Sweave = S + weave).</p>
</blockquote>

<p>Now, if you haven&#39;t heard it, well I guess now you have.  But more importantly, do <a href="http://yihui.name/knitr/">some research on knitr</a>.  It&#39;s awesome, and there&#39;s even a <a href="http://www.amazon.com/gp/product/1482203537">Book from the author of <code>knitr</code>, Yihui Xie</a> and a corresponding <a href="https://github.com/yihui/knitr-book">GitHub repository</a>.  Also, you may want to read why you should <a href="http://biostatistics.oxfordjournals.org/content/10/3/405.full">care about reproducible results</a>.  </p>

<p>Overall, <code>knitr</code> is a system that allows for dynamic documents, which I will define as files that contain code and prose/text/words/comments/notes.</p>

<h3>Knitr Languages</h3>

<p>Why am I talking about Stata?  Well, I use Stata.  Also, if you&#39;re using SAS, Python, CoffeeScript or some other languages, then <code>knitr</code> has already incorporated these into the <code>R</code> system: <a href="http://yihui.name/knitr/demo/engines/">http://yihui.name/knitr/demo/engines/</a>.  </p>

<p>Let&#39;s just list some resources for doing some knitting in Stata:</p>

<ul>
<li><p>There is a post on the Stata list-serv:
<a href="http://www.stata.com/statalist/archive/2012-07/msg00323.html">http://www.stata.com/statalist/archive/2012-07/msg00323.html</a></p></li>
<li><p>And the corresponding github repo from that post (link fixed): <a href="https://github.com/amarder/stata-tutorial">https://github.com/amarder/stata-tutorial</a>, which is intended to be run completely in Stata, which I will refer to as <code>knitr.do</code>.</p></li>
<li><p>I tried that out, and a question discussion spurned on Stack Overflow on someone who asked me about it: <a href="http://stackoverflow.com/questions/20539177/markdown-in-other-statistics-packages-than-r/20573096">http://stackoverflow.com/questions/20539177/markdown-in-other-statistics-packages-than-r/20573096</a></p></li>
<li><p>StatWeave (a precursor to <code>knitr</code>) is still a viable option from Russell Lenth from U Iowa <a href="http://homepage.cs.uiowa.edu/%7Erlenth/StatWeave/">http://homepage.cs.uiowa.edu/~rlenth/StatWeave/</a>. </p></li>
</ul>

<p>Now, I <em>highly</em> suggest taking a look at the github repo and <code>knitr.do</code> and StatWeave.  Actually, no.  Stop reading this post and check it out.  I can wait.  Go.  I&#39;m going to talk about how to do this within <code>R</code>.</p>

<h2>And&hellip; We&#39;re back</h2>

<p>So these options are good and are mainly options to create a markdown document that <strong>Stata</strong> will run/manipulate.  This is vital for someone who doesn&#39;t know <code>R</code>.  Here are some notes I have:</p>

<ol>
<li> <code>knitr</code> has a lot of good options already made and is expanding.  No inventing the wheel with respect to highlighting/parsing/etc.  Also, a large community uses it.</li>
<li> I want to know one syntax for markdown. OK, maybe two, one for html, the other for LaTeX. </li>
<li> <code>knitr.do</code> uses parsing based on indenting from what I can see.  I like demarcating code; I feel like it&#39;s safer/robust.  This could easily be changed if the user wanted it.  StatWeave allows code demarcation by <code>\begin{Statacode}</code> and \end{Statacode}.<br/></li>
<li> <code>knitr.do</code> didn&#39;t seem to have an inline code option.  StatWeave allows you to add inline text.  For example, stating that the dataset had 100 rows and the maximum age was 30.  StatWeave uses the Sweave syntax, but uses <code>Stataexpr</code> instead of <code>\Sexpr</code>, so that you could fill in that 30 by using <code>\Stataexpr{max(age)}</code> instead of writing 30.  This is a huge capability for truly dynamic documents.</li>
<li> StatWeave is maintained mainly, I believe, by one person (Russell Lenth).  This is how <code>knitr</code> started in some capacity before it became more popular, but it was built upon a community-used system <code>R</code> that had a pre-existing software that was similar (<code>Sweave</code>).  Hence, I think <code>knitr</code> has more longevity and more learning capital compared to either option.  Also, StatWeave (or its functionality) may be integrated into <code>knitr</code>.</li>
<li> StatWeave can only be written in LaTeX syntax (since OpenOffice bug precludes it from making odt docs).  <code>knitr.do</code> can do markdown, which can be converted to pdf, docx, html, or many other formats using <a href="http://johnmacfarlane.net/pandoc/"><code>pandoc</code></a>.<br/></li>
<li> Neither option allows for automatically saving and naming plots in any system I can see.  This must be done in Stata code using normal graph saving methods, e.g. <code>graph export</code>.</li>
<li> <code>knitr.do</code> inherently uses logs. I can&#39;t really determine what StatWeave uses because it&#39;s written in Java. </li>
</ol>

<p>Now, I&#39;m going to assume how to use <code>knitr</code> and see how we could do some reporting using <code>knitr</code>.  </p>

<h3>99 Problems and they&#39;re Stata problems</h3>

<p>If you are running <code>knitr</code> from <code>R</code>, again, <a href="http://yihui.name/en/">Yihui</a> has incorporated a lot of other languages to process.  What are some potential problems with processing the same way in Stata?</p>

<ul>
<li>Stata is inherently just a command line, but when you call it, it calls a GUI if you don&#39;t have Stata(console).  More on Stata(console) that later.<br/>

<ul>
<li>You can start Stata by the command line in <a href="http://www.stata.com/support/faqs/unix/batch-mode/">Unix</a> or <a href="http://www.stata.com/support/faqs/windows/batch-mode/">Windows</a> with help from those links.</li>
</ul></li>
<li>In order to use Stata from the command line, you probably need to put the path to Stata in your PATH variable: <a href="http://www.stata.com/support/faqs/mac/advanced-topics/">http://www.stata.com/support/faqs/mac/advanced-topics/</a>.  For example, the path <code>/Applications/Stata/Stata.app/Contents/MacOS/</code> is in my PATH, so that I can go to the Terminal and type <code>Stata</code>.  (Side note: this is the way to start multiple Stata sessions on a Mac). Let&#39;s assume you didn&#39;t do this though.<br/></li>
</ul>

<p>Let&#39;s just make a test .do file:</p>

<pre><code class="bash">  cat Stata_Markdown.do
</code></pre>

<pre><code>clear 
disp &quot;hello world!&quot;
exit, clear
</code></pre>

<p>Now how to run it?  Let&#39;s use <code>bash</code>, which is supported by <code>knitr</code>.  So I just have in my <code>knitr</code> code chunk options, <code>engine=&#39;bash&#39;</code>.  Don&#39;t forget <code>comment=&quot;&quot;</code> if you don&#39;t want <code>#</code> to be printed (which is the default comment character).</p>

<pre><code class="bash">stata -b Stata_Markdown.do 
echo $? ### print last return
</code></pre>

<pre><code>127
</code></pre>

<p>Since <code>echo $?</code> is supposed to print 0 if there is no error, there was an error.  Worse off, there was a <strong>silent</strong> error in the sense it didn&#39;t print a message of error as output for bash.  This error occurs because my <code>bash</code> doesn&#39;t have a <code>stata</code> or <code>Stata</code> command.  We can either make aliases in <code>.bash_profile</code> or <code>.bashrc</code> or again put <code>Stata</code> in my path, but let&#39;s just be explicit about the Stata command by using the full path: for me, it&#39;s  <code>/Applications/Stata/Stata.app/Contents/MacOS/stata</code>.  We also don&#39;t see anything from the log file, which makes sense because nothing happened. </p>

<ul>
<li>But a real problem is the Stata log file is not made in a &ldquo;timely&rdquo; manner in this process.  Let&#39;s rerun the code with the full path for Stata:</li>
</ul>

<pre><code class="bash">/Applications/Stata/Stata.app/Contents/MacOS/stata -b &quot;Stata_Markdown.do&quot; 
echo $?
cat Stata_Markdown.log
</code></pre>

<pre><code>0

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   11.2   Copyright 1985-2009 StataCorp LP
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
                                      College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

35-student Stata lab perpetual license:
       Serial number:  30110513240
         Licensed to:  Biostat
                       Johns Hopkins University

Notes:
      1.  10.00 MB allocated to data
      2.  Stata running in batch mode

. do Stata_Markdown.do 

. clear 

. disp &quot;hello world!&quot;
hello world!

. exit, clear

end of do-file
</code></pre>

<ul>
<li><p>Success! Well, it worked by the error being 0, but not really a &ldquo;success&rdquo; as nothing was printed.  So what does this code for running Stata mean? </p>

<ul>
<li><code>/Applications/Stata/Stata.app/Contents/MacOS/stata</code> says &ldquo;run stata&rdquo;</li>
<li><code>-b</code> says I want to run in <a href="http://en.wikipedia.org/wiki/Batch_processing">&ldquo;batch mode&rdquo;</a>, which is much different than <a href="http://www.youtube.com/watch?v=xSZdntRnQVg">&ldquo;beast mode&rdquo;</a>.</li>
<li><code>Stata_Markdown.do</code> filename I want to run
Now, if there was a space in the path to Stata, it needs to be quoted with <code>&quot;</code>.  But <strong>IMPORTANTLY</strong>, the Stata console came up and I had to hit &ldquo;OK&rdquo;, INTERACTIVELY!!  Not very automated, but we&#39;ll fix this in a moment.</li>
</ul></li>
<li><p>But what about the <code>cat Stata_Markdown.log</code>, which is auto-generated by the Stata command? Was the log empty?</p>

<pre><code class="bash">cat Stata_Markdown.log
</code></pre>

<pre><code>
___  ____  ____  ____  ____ (R)
/__    /   ____/   /   ____/
___/   /   /___/   /   /___/   11.2   Copyright 1985-2009 StataCorp LP
Statistics/Data Analysis            StataCorp
                                    4905 Lakeway Drive
                                    College Station, Texas 77845 USA
                                    800-STATA-PC        http://www.stata.com
                                    979-696-4600        stata@stata.com
                                    979-696-4601 (fax)

35-student Stata lab perpetual license:
     Serial number:  30110513240
       Licensed to:  Biostat
                     Johns Hopkins University

Notes:
    1.  10.00 MB allocated to data
    2.  Stata running in batch mode

. do Stata_Markdown.do 

. clear 

. disp &quot;hello world!&quot;
hello world!

. exit, clear

end of do-file
</code></pre>

<p><strong>WHAT?</strong> Running the command again gives us what we want?  Now, we can either do 2 code chunks, but if we set the <code>results=&#39;hold&#39;</code> option in <code>knitr</code>, then things work fine.</p>

<ul>
<li>You can get around this unwanted &ldquo;interactivity&rdquo; using the console version of Stata, but I didn&#39;t set it up and <a href="http://www.stata.com/support/mac/">Stata for Mac</a> says:
&gt; Can I display graphs with Stata(console)? 
&gt; No. Stata(console) is a text-based application and has no graphical display capabilities. However, it can generate and save Stata graphs, which can then be viewed with Stata(GUI). Stata(console) can also convert Stata graphs to PostScript and save them as files. </li>
</ul></li>
</ul>

<p>Also, Stata(console) for Mac needs Stata/SE or State/MP (aka more costly Stata) according to <a href="http://www.stata.com/manuals13/gsmc.pdf">Section C.4 Stata(console) for Mac OS X</a>.  So for most users you&#39;d have to buy a different Stata.  </p>

<ul>
<li>Another way of getting around this interaction would be having Stata auto-exit; let&#39;s do that.  Exiting Stata is possible without having interaction with a specific option when you exit, so you have <code>exit, clear STATA</code>.  Let&#39;s look at our new script <code>Stata_Markdown_Exit.do</code>:</li>
</ul>

<pre><code class="bash">cat Stata_Markdown_Exit.do
</code></pre>

<pre><code>clear 
disp &quot;hello world!&quot;
exit, clear STATA
</code></pre>

<p>Now let&#39;s run it.</p>

<pre><code class="bash">/Applications/Stata/Stata.app/Contents/MacOS/stata -b &quot;Stata_Markdown_Exit.do&quot;
echo $?
cat Stata_Markdown_Exit.log
</code></pre>

<pre><code>0

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   11.2   Copyright 1985-2009 StataCorp LP
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
                                      College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

35-student Stata lab perpetual license:
       Serial number:  30110513240
         Licensed to:  Biostat
                       Johns Hopkins University

Notes:
      1.  10.00 MB allocated to data
      2.  Stata running in batch mode

. do Stata_Markdown_Exit.do 

. clear 

. disp &quot;hello world!&quot;
hello world!

. exit, clear STATA
</code></pre>

<p>It looks the same as before with no output, but <strong>I did not have to interact with Stata</strong>.  Note: if you use <code>&amp;</code> at the end of the command, the <code>echo $?</code> will come up zero, because <code>bash</code> will see it a background process.  </p>

<h3>But I don&#39;t want to show the whole script all the time</h3>

<p>You may notice that I printed with <code>cat</code> the entire log that was created with Stata.  Honestly, I don&#39;t like Stata logs.  They seem like a nuisance and I have a script and can make outputs, so why need a log?  But here, it seems useful.  But what happens when you want to show <strong>parts</strong> of a script at different points?  You can obviously make a series of .do files.  Not really a good solution. </p>

<p>What&#39;s a better solution? Create logs in your Stata code and then cat them to different code chunks.  Here&#39;s an example:</p>

<pre><code class="bash">cat Stata_Markdown_logs.do
</code></pre>

<pre><code>clear 
log using print_hello.log, replace
disp &quot;hello world!&quot;
log close

log using run_summ.log, replace
set obs 100
gen x = rnormal(100)
summ x
log close 
exit, clear STATA
</code></pre>

<pre><code class="bash">/Applications/Stata/Stata.app/Contents/MacOS/stata -b &quot;Stata_Markdown_logs.do&quot; 
</code></pre>

<p>Now, since <code>print_hello.log</code>, and <code>run_summ.log</code> were created, I can just do.</p>

<pre><code class="bash">cat print_hello.log
</code></pre>

<pre><code>--------------------------------------------------------------------------------------------------------
      name:  &lt;unnamed&gt;
       log:  /Users/muschellij2/Dropbox/Public/WordPress_Hopstat/Stata_Markdown/print_hello.log
  log type:  text
 opened on:  11 Jan 2014, 18:10:16

. disp &quot;hello world!&quot;
hello world!

. log close
      name:  &lt;unnamed&gt;
       log:  /Users/muschellij2/Dropbox/Public/WordPress_Hopstat/Stata_Markdown/print_hello.log
  log type:  text
 closed on:  11 Jan 2014, 18:10:16
--------------------------------------------------------------------------------------------------------
</code></pre>

<p>and then later say:</p>

<pre><code class="bash">cat run_summ.log
</code></pre>

<pre><code>--------------------------------------------------------------------------------------------------------
      name:  &lt;unnamed&gt;
       log:  /Users/muschellij2/Dropbox/Public/WordPress_Hopstat/Stata_Markdown/run_summ.log
  log type:  text
 opened on:  11 Jan 2014, 18:10:16

. set obs 100
obs was 0, now 100

. gen x = rnormal(100)

. summ x

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
           x |       100    100.0006    1.061928   97.11491   101.8377

. log close 
      name:  &lt;unnamed&gt;
       log:  /Users/muschellij2/Dropbox/Public/WordPress_Hopstat/Stata_Markdown/run_summ.log
  log type:  text
 closed on:  11 Jan 2014, 18:10:16
--------------------------------------------------------------------------------------------------------
</code></pre>

<h3>No header/footer from log</h3>

<p>This works, but you have a header and footer, that you probably <a href="http://www.stata.com/statalist/archive/2004-08/msg00177.html">can&#39;t delete with some simple option</a>.  Now, obviously you can read them in <code>R</code> and do string manipulation and then print them back out, but that&#39;s a little convoluted.  Regardless, I wrote a simple function in <code>R</code> that will do it:</p>

<pre><code class="r">catlog &lt;- function(filename, runcat = TRUE, comment = &quot;&quot;) {
    x = readLines(filename)
    lenx = length(x)
    x = x[7:(lenx - 6)]
    writeLines(x, filename)
    if (runcat) 
        cat(x, sep = &quot;\n&quot;)
}
catlog(&quot;run_summ.log&quot;)
</code></pre>

<pre><code>. set obs 100
obs was 0, now 100

. gen x = rnormal(100)

. summ x

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
           x |       100    100.0006    1.061928   97.11491   101.8377
</code></pre>

<p>totally in <code>R</code> or then just use the saved log file can print it using <code>cat</code> from bash:</p>

<pre><code class="bash">cat run_summ.log
</code></pre>

<pre><code>. set obs 100
obs was 0, now 100

. gen x = rnormal(100)

. summ x

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
           x |       100    100.0006    1.061928   97.11491   101.8377
</code></pre>

<p>or in <code>bash</code>, one example would be:</p>

<pre><code class="bash">nlines=`awk &#39;END{print NR}&#39; print_hello.log`
nhead=`expr $nlines - 6`
ntail=`expr $nlines - 12`
head -$nhead print_hello.log | tail -$ntail
</code></pre>

<pre><code>. disp &quot;hello world!&quot;
hello world!
</code></pre>

<p>or even better, let&#39;s make a function for <code>bash</code> that will do it:</p>

<pre><code class="bash">catlog () {
  nlines=`awk &#39;END{print NR}&#39; $1`
  nhead=`expr $nlines - 6`
  ntail=`expr $nlines - 12`
  head -$nhead $1 | tail -$ntail
}

catlog print_hello.log
</code></pre>

<pre><code>. disp &quot;hello world!&quot;
hello world!
</code></pre>

<h3>Cleanup</h3>

<p>You can just do some .log clean up using:</p>

<pre><code class="bash">rm *.log  
</code></pre>

<p>if you want to delete all logs in your folder (assuming you never changed directories).</p>

<h3>Thoughts</h3>

<p>You can do &ldquo;markdown&rdquo; in Stata.  My thoughts:
1.  It&#39;s complicated.
2.  The <code>knitr.do</code> file is a good start.
3.  Plotting hasn&#39;t really been integrated.  You can always do a <code>graph export myplot.pdf, as(pdf)</code> (on Mac) or whatever and then just put in <code>&lt;img src=&quot;myplot.pdf&quot;&gt;</code> in your html, or <code>\includegraphics{myplot.pdf}</code> in LaTeX, but that&#39;s not as integrated as it needs to be.<br/>
4.  If you make it marked down, you can use the great <a href="http://johnmacfarlane.net/pandoc/">pandoc</a> to potentially then just make it a Word .doc.
5. It will be integrated in the future.  The question is how close is that &ldquo;future&rdquo;?</p>

<h2>Conclusion</h2>

<p>StatWeave has a lot of qualities like <code>knitr</code> but doesn&#39;t have general Markdown support, which is necessary because pandoc can then go do Word (which many people want), but can do inline commands.  <code>knitr.do</code> uses Markdown, but doesn&#39;t have code demarcation.  It also doesn&#39;t do inline commands, which are a requirement for a dynamic doc, so you don&#39;t have to fill in the numbers and can do it dynamically with code.  Neither has an automated naming and saving scheme for graphics. </p>

<p>My main concern with either option is putting in a lot of time for these and then they becoming obsolete with <code>knitr</code> integration.  That&#39;s not a big problem, since I know <code>knitr</code> but something to think about for someone who doesn&#39;t.  My recommendation, if you know and want to use LaTeX or need inline numbers, go with StatWeave.  Otherwise <code>knitr.do</code> may do the trick.  Also, I&#39;ve given you some directions on &ldquo;growwing your own&rdquo;, which is the most customizable for you but even worse with respect to time, reinventing the wheel, and no support from others. </p>

<p>Anyway, those are the current options I know about when doing Markdown with Stata.</p>

</body>

</html>

